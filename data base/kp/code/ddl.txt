CREATE TYPE PROBLEM_TYPE AS ENUM ('UI', 'BUGS', 'SCRIPT');
CREATE TYPE HOUSE_TYPE AS ENUM ('APARTMENTS', 'VILLAS', 'HIGH-END','ORDINARY');
CREATE TYPE FURNITURE_TYPE AS ENUM ('AIR_CONDITION','LIGHT', 'HUMIDIFIER', 'BATHTUB', 'OUTLET','CURTAINS', 'FAN', 'CAMERA', 'WATER_HEATER');
CREATE TYPE ACTION_TYPE AS ENUM ('CLOSE','OPEN','SWITCH_OFF','SWITCH_ON','ADJUST_VALUE','TURN_ON','TURN_OFF');
CREATE TYPE SCRIPT_TYPE AS ENUM ('CONDITIONAL','SCHEDULE');
CREATE TYPE COUNTRY AS ENUM('US','UK','RUSSIAN','CHINA','FRANCE');
create type city as enum('Shanghai', 'Beijing', 'Shenzhen', 'Guangzhou', 'Chengdu','Paris', 'Marseille', 'Lyon', 'Toulouse','Cambridge', 'Edinburgh',  'London', 'Liverpool','New York', 'Los Angeles', 'Chicago', 'Boston');
create type room_type as enum('KITCHEN','BEDROOM','BATHROOM','LIVING');
create type gender as enum ('MAN','WOMAN');
CREATE TABLE if not exists "user"(
    id serial primary key not null ,
    password varchar(256) not null ,
    gender gender not null ,
    name varchar(64) not null,
    age int not null check ( age > 0 )
);
CREATE TABLE if not exists Support_man(
    id serial primary key not null ,
    password varchar(256) not null,
    name varchar(64) not null ,
    is_free boolean not null DEFAULT True
);
create table if not exists Problem(
    id serial primary key not null ,
    user_id int not null REFERENCES  "user"(id),
    support_man_id int not null REFERENCES Support_man(id),
    is_finished boolean not null DEFAULT false,
    description text not null,
    type problem_type not null,
    Data date default current_date
);
create table if not exists address(
    id serial not null primary key ,
    country country not null ,
    city city not null ,
    street varchar(128) not null
);
create table if not exists House(
    id serial primary key not null ,
    address_id int references address(id) not null ,
    type house_type not null
);
create table if not exists Room(
    id serial primary key not null ,
    house_id int not null references House(id),
    square float not null,
    height float not null,
    type room_type not null,
    is_filled boolean not null default false
);
create table if not exists furniture(
    id serial primary key not null ,
    room_id int references Room(id) not null ,
    manufacture varchar(258) not null ,
    Available boolean not null default True,
    type furniture_type not null
);
create table if not exists action(
    id serial primary key not null ,
    type_furniture furniture_type not null ,
    type action_type not null ,
    description text
);
create table if not exists script(
    id serial primary key not null ,
    creator_name varchar(256) not null,
    type script_type not null
);
create table if not exists schedule_script(
    script_id int references script(id) not null ,
    start_time time not null ,
    end_time time not null
);
create table if not exists Condition_script(
    script_id int references script(id) not null ,
    condition text not null
);
create table if not exists contact(
    user_id int references "user"(id) not null unique,
    email varchar(128) not null unique ,
    phone varchar(64) not null unique
);
create table if not exists List_Action_Script(
    id serial not null primary key ,
    script_id int references script(id),
    action_id int references action(id)
);
create table if not exists list_script_user(
    id serial not null primary key ,
    script_id int references script(id),
    user_id int references "user"(id),
    unique (script_id,user_id)
);
create table if not exists list_user_house(
    id serial not null primary key ,
    user_id int references "user"(id),
    house_id int references House(id),
    unique (user_id,house_id)
);